<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Test Règles V2</title>
  <style>
    body { font-family: system-ui; padding: 20px; }
    pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>Test de chargement des règles</h1>
  <div id="results"></div>

  <script type="module">
    const resultsDiv = document.getElementById('results');

    async function testRulesLoading() {
      try {
        resultsDiv.innerHTML += '<h2>1. Test chargement rules-config.json</h2>';

        const response = await fetch('http://localhost:7001/js/config/rules-config.json');
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const config = await response.json();
        resultsDiv.innerHTML += `<p class="success">✅ Fichier chargé avec succès</p>`;
        resultsDiv.innerHTML += `<pre>${JSON.stringify(config, null, 2).substring(0, 1000)}...</pre>`;

        resultsDiv.innerHTML += '<h2>2. Test conversion en règles</h2>';

        // Test conversion seuils
        const seuils = Object.entries(config.seuils || {});
        resultsDiv.innerHTML += `<p class="success">✅ Seuils trouvés: ${seuils.length}</p>`;

        // Test conversion validations
        const validations = Object.entries(config.validations || {});
        resultsDiv.innerHTML += `<p class="success">✅ Validations trouvées: ${validations.length}</p>`;

        // Test conversion délais
        const delais = Object.entries(config.delais_types || {});
        resultsDiv.innerHTML += `<p class="success">✅ Délais trouvés: ${delais.length}</p>`;

        // Test conversion garanties
        const garanties = Object.entries(config.garanties || {}).filter(([k]) => k !== 'description');
        resultsDiv.innerHTML += `<p class="success">✅ Garanties trouvées: ${garanties.length}</p>`;

        // Test matrices
        const matrices = Object.keys(config.matrices_procedures || {});
        resultsDiv.innerHTML += `<p class="success">✅ Matrices trouvées: ${matrices.length}</p>`;

        // Test ANO
        const ano = config.ano;
        resultsDiv.innerHTML += `<p class="success">✅ ANO configuré: ${ano ? 'Oui' : 'Non'}</p>`;

        resultsDiv.innerHTML += '<h2>3. Détails ANO</h2>';
        if (ano) {
          resultsDiv.innerHTML += `<pre>${JSON.stringify(ano, null, 2)}</pre>`;
        }

        resultsDiv.innerHTML += '<h2>4. Détails Matrices</h2>';
        resultsDiv.innerHTML += `<pre>${JSON.stringify(config.matrices_procedures, null, 2).substring(0, 1500)}...</pre>`;

      } catch (error) {
        resultsDiv.innerHTML += `<p class="error">❌ Erreur: ${error.message}</p>`;
        console.error(error);
      }
    }

    testRulesLoading();
  </script>
</body>
</html>
